<!doctype html>

<script>
  (function() {
    navigator.serviceWorker.register('sw.js').then(function() {
      console.log('Ready');
    }, function(e) {
      console.error(e);
    });

    var requests = {
      '/tests/test_ignoreSearch_store': {},

      // other
      'test_ignoreSearch_keysRequest:no-polyfill': [
        '/ignoreSearch',
      ],

      // match()
      '/tests/test_ignoreSearch_matchIgnoreNoQuery': { cached: true, index: 1 },
      '/tests/test_ignoreSearch_matchNoQuery': { cached: true, index: 4 },
      '/tests/test_ignoreSearch_matchIgnoreWithQuery': { cached: true, index: 1 },
      '/tests/test_ignoreSearch_matchWithQuery': { cached: true, index: 3 },
      '/tests/test_ignoreSearch_matchIgnoreNoMatch': { cached: false },
      '/tests/test_ignoreSearch_matchNoMatch': { cached: false },

      // matchAll()
      '/tests/test_ignoreSearch_matchAllIgnoreNoQuery': [
        { cached: true, index: 1 },
        { cached: true, index: 2 },
        { cached: true, index: 3 },
        { cached: true, index: 4 },
      ],
      '/tests/test_ignoreSearch_matchAllNoQuery': [
        { cached: true, index: 4 }
      ],
      '/tests/test_ignoreSearch_matchAllIgnoreWithQuery': [
        { cached: true, index: 1 },
        { cached: true, index: 2 },
        { cached: true, index: 3 },
        { cached: true, index: 4 },
      ],
      '/tests/test_ignoreSearch_matchAllWithQuery': [
        { cached: true, index: 3 }
      ],
      '/tests/test_ignoreSearch_matchAllIgnoreNoMatch': [],
      '/tests/test_ignoreSearch_matchAllNoMatch': [],

      // keys() basics

      'test_ignoreSearch_keysRequest': [
        '/ignoreSearch',
      ],

      '/tests/test_ignoreSearch_keysNoRequest': [
        '/__ignoreSearch',
        '/ignoreSearch?1',
        '/ignoreSearch?2',
        '/ignoreSearch?3',
        '/ignoreSearch',
      ],

      // keys(request)
      '/tests/test_ignoreSearch_keysIgnoreNoQuery': [
        '/ignoreSearch?1',
        '/ignoreSearch?2',
        '/ignoreSearch?3',
        '/ignoreSearch',
      ],
      '/tests/test_ignoreSearch_keysNoQuery': [
        '/ignoreSearch',
      ],
      '/tests/test_ignoreSearch_keysIgnoreWithQuery': [
        '/ignoreSearch?1',
        '/ignoreSearch?2',
        '/ignoreSearch?3',
        '/ignoreSearch',
      ],
      '/tests/test_ignoreSearch_keysWithQuery': [
        '/ignoreSearch?3',
      ],
      '/tests/test_ignoreSearch_keysIgnoreNoMatch': [],
      '/tests/test_ignoreSearch_keysNoMatch': [],

      // delete()
      '/tests/test_ignoreSearch_deleteIgnoreNoQuery': {
        deleted: true,
        keys: ['/__ignoreSearch']
      },
      '/tests/test_ignoreSearch_deleteNoQuery': {
        deleted: true,
        keys: [
          '/__ignoreSearch',
          '/ignoreSearch?1',
          '/ignoreSearch?2',
          '/ignoreSearch?3',
        ]
      },
      '/tests/test_ignoreSearch_deleteIgnoreWithQuery': {
        deleted: true,
        keys: ['/__ignoreSearch']
      },
      '/tests/test_ignoreSearch_deleteWithQuery': {
        deleted: true,
        keys: [
          '/__ignoreSearch',
          '/ignoreSearch?1',
          '/ignoreSearch?2',
          '/ignoreSearch',
        ]
      },
      '/tests/test_ignoreSearch_deleteIgnoreNoMatch': {
        deleted: false,
        keys: [
          '/__ignoreSearch',
          '/ignoreSearch?1',
          '/ignoreSearch?2',
          '/ignoreSearch?3',
          '/ignoreSearch',
        ]
      },
      '/tests/test_ignoreSearch_deleteNoMatch': {
        deleted: false,
        keys: [
          '/__ignoreSearch',
          '/ignoreSearch?1',
          '/ignoreSearch?2',
          '/ignoreSearch?3',
          '/ignoreSearch',
        ]
      },

      // CacheStorage#match()
      '/tests/test_ignoreSearch_storageMatchIgnoreNoQuery': { cached: true, index: 1 },
      '/tests/test_ignoreSearch_storageMatchNoQuery': { cached: true, index: 4 },
      '/tests/test_ignoreSearch_storageMatchIgnoreWithQuery': { cached: true, index: 1 },
      '/tests/test_ignoreSearch_storageMatchWithQuery': { cached: true, index: 3 },

      // CacheStorage#match() no cache name
      '/tests/test_ignoreSearch_storageMatchNoCacheIgnoreNoQuery': { cached: true, index: 1 },
      '/tests/test_ignoreSearch_storageMatchNoCacheNoQuery': { cached: true, index: 4 },
      '/tests/test_ignoreSearch_storageMatchNoCacheIgnoreWithQuery': { cached: true, index: 1 },
      '/tests/test_ignoreSearch_storageMatchNoCacheWithQuery': { cached: true, index: 3 },
    };

    /*var requests = {
      '/tests/test_ignoreSearch_store': {},
      '/tests/test_ignoreSearch_keysRequest': [
        '/ignoreSearch',
      ],
      '/tests/test_ignoreSearch_keysRequest:no-polyfill': [
        '/ignoreSearch',
      ],
    };*/

    window.start = function() {
      Object.keys(requests).reduce(function(prev, req) {
        return prev.then(function() {
          return fetch(req);
        }).then(function(res) {
          return res.json();
        }).then(function(actual) {
          const expected = requests[req];

          if (JSON.stringify(expected) === JSON.stringify(actual)) {
            console.log(`Request [${ req }] passed`);
          } else {
            console.error(`Request [${ req }] not passed`);
            console.info('Expected:', JSON.stringify(expected, null, '  '));
            console.info('Actual:', JSON.stringify(actual, null, '  '));
          }
        });
      }, Promise.resolve()).then(function() {
        console.info('DONE');
      });
    };
  }());
</script>